package machines

import (
	"github.com/TheLab-ms/conway/engine"
	"github.com/TheLab-ms/conway/modules/bootstrap"
	"time"
)

type printerStatus struct {
	Name string
	JobFinishedAt *engine.LocalTime
	ErrorCode     string
}

templ renderMachines(printers []*printerStatus) {
	@bootstrap.View() {
		<div class="container my-5">
			<div class="mt-3">
				<h2>Printers</h2>
				<table class="table table-bordered table-striped">
					<thead>
						<tr>
							<th>Printer</th>
							<th>Status</th>
							<th>Print Completion Estimate</th>
							<th>Error Code</th>
						</tr>
					</thead>
					<tbody>
						for _, printer := range printers {
							<tr>
								<td>{printer.Name}</td>
								if printer.JobFinishedAt != nil {
									if timeUntil := time.Until(printer.JobFinishedAt.Time); timeUntil > 0 {
										<td>In Use</td>
										<td>{timeUntil.Round(time.Minute).String()}</td>
									} else if timeUntil > -2*time.Hour {
										<td>In Use</td>
										<td>Overdue</td>
									} else {
										<td>Available</td>
										<td></td>
									}
								} else {
									<td>Available</td>
									<td></td>
								}
								<td>{printer.ErrorCode}</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	}
}
